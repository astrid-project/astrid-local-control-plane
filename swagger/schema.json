{
  "produces": [
    "application/json"
  ],
  "consumes": [
    "application/json"
  ],
  "tags": [
    {
      "name": "code",
      "description": "Code injection at run-time."
    },
    {
      "name": "config",
      "description": "Configuration at run-time."
    },
    {
      "name": "status",
      "description": "Status data of the LCP."
    }
  ],
  "paths": {
    "/code/{id}": {
      "delete": {
        "summary": "Code injection",
        "description": "Inject code at run-time in the local environment.",
        "parameters": [
          {
            "name": "payload",
            "required": true,
            "in": "body",
            "schema": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/Code_Request_"
              }
            }
          }
        ],
        "tags": [
          "code"
        ],
        "responses": {
          "200": {
            "description": "Code injection executed.",
            "schema": {
              "$ref": "#/definitions/Code_Response_"
            }
          },
          "400": {
            "description": "Bad Request.",
            "schema": {
              "$ref": "#/definitions/Code_Response_"
            }
          },
          "401": {
            "description": "Unauthorized.",
            "schema": {
              "$ref": "#/definitions/Code_Response_"
            }
          }
        }
      },
      "post": {
        "summary": "Code injection",
        "description": "Inject code at run-time in the local environment.",
        "parameters": [
          {
            "name": "payload",
            "required": true,
            "in": "body",
            "schema": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/Code_Request_"
              }
            }
          }
        ],
        "tags": [
          "code"
        ],
        "responses": {
          "200": {
            "description": "Code injection executed.",
            "schema": {
              "$ref": "#/definitions/Code_Response_"
            }
          },
          "400": {
            "description": "Bad Request.",
            "schema": {
              "$ref": "#/definitions/Code_Response_"
            }
          },
          "401": {
            "description": "Unauthorized.",
            "schema": {
              "$ref": "#/definitions/Code_Response_"
            }
          }
        }
      },
      "put": {
        "summary": "Update injected code",
        "description": "Update the injected code at run-time in the local environment.",
        "parameters": [
          {
            "name": "payload",
            "required": true,
            "in": "body",
            "schema": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/Code_Request_"
              }
            }
          }
        ],
        "tags": [
          "code"
        ],
        "responses": {
          "200": {
            "description": "Code injection executed.",
            "schema": {
              "$ref": "#/definitions/Code_Response_"
            }
          },
          "400": {
            "description": "Bad Request.",
            "schema": {
              "$ref": "#/definitions/Code_Response_"
            }
          },
          "401": {
            "description": "Unauthorized.",
            "schema": {
              "$ref": "#/definitions/Code_Response_"
            }
          }
        }
      }
    },
    "/config": {
      "post": {
        "summary": "Configuration update",
        "description": "Apply configuration changes to the local environment.",
        "tags": [
          "config"
        ],
        "parameters": [
          {
            "name": "payload",
            "required": true,
            "in": "body",
            "schema": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/Config_Request_"
              }
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Configuration changes executed.",
            "schema": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/Config_Response_"
              }
            }
          },
          "400": {
            "description": "Bad request.",
            "schema": {
              "$ref": "#/definitions/Config_Response_"
            }
          },
          "401": {
            "description": "Unauthorized.",
            "schema": {
              "$ref": "#/definitions/Config_Response_"
            }
          }
        }
      }
    },
    "/status": {
      "get": {
        "summary": "Status info",
        "description": "Get info about the status of the LCP in the execution environment.",
        "tags": [
          "status"
        ],
        "responses": {
          "200": {
            "description": "Status data of the LCP.",
            "schema": {
              "$ref": "#/definitions/Status_Response_"
            }
          },
          "401": {
            "description": "Unauthorized.",
            "schema": {
              "$ref": "#/definitions/Code_Response_"
            }
          }
        }
      },
      "post": {
        "summary": "Status set.",
        "description": "Set the last heartbeat.",
        "tags": [
          "status"
        ],
        "responses": {
          "200": {
            "description": "Status data of the LCP.",
            "schema": {
              "$ref": "#/definitions/Status_Response_"
            }
          },
          "401": {
            "description": "Unauthorized.",
            "schema": {
              "$ref": "#/definitions/Code_Response_"
            }
          }
        }
      }
    }
  },
  "info": {
    "title": "Local Control Plane",
    "version": "7b358d78660d0b524f43218a0fda414fa7f3c239@master"
  },
  "swagger": "2.0",
  "definitions": {
    "Code_Request_": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "example": "firewall",
          "description": "Code name."
        },
        "source": {
          "type": "string",
          "description": "Code source"
        }
      },
      "required": [
        "name",
        "source"
      ]
    },
    "Code_Result_Response_": {
      "type": "object",
      "properties": {
        "warning": {
          "type": "string",
          "example": "Useless properties: id",
          "description": "Warning message."
        }
      }
    },
    "Code_Response_": {
      "type": "object",
      "properties": {
        "results": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/Code_Result_Response_"
          }
        },
        "when": {
          "type": "string",
          "format": "date-time",
          "example": "2020/02/13 15:27:06",
          "description": "Datetime of the configuration changes."
        }
      },
      "required": [
        "results",
        "when"
      ]
    },
    "Config_Parameter_Request_": {
      "type": "object",
      "properties": {
        "value": {
          "type": "string",
          "example": "10s",
          "description": "Parameter new value."
        },
        "path": {
          "type": "array",
          "items": {
            "type": "string",
            "example": "period",
            "description": "Key path."
          }
        },
        "id": {
          "type": "string",
          "example": "period",
          "description": "Id of the parameter."
        },
        "source": {
          "type": "string",
          "example": "firewall.xml",
          "description": "Source filename."
        },
        "schema": {
          "type": "string",
          "enum": [
            "json",
            "properties",
            "xml",
            "yaml"
          ],
          "example": "yaml",
          "description": "Scheme."
        }
      },
      "required": [
        "id",
        "schema",
        "source",
        "value"
      ]
    },
    "Config_Action_Request_": {
      "type": "object",
      "properties": {
        "cmd": {
          "type": "string",
          "description": "Command."
        },
        "id": {
          "type": "string",
          "example": "start",
          "description": "Id of the action."
        },
        "args": {
          "type": "string",
          "example": "-al",
          "description": "Single command argument."
        },
        "daemon": {
          "type": "string",
          "example": "firewall",
          "description": "Key used to execute the command as daemon."
        }
      },
      "required": [
        "cmd",
        "id"
      ]
    },
    "Config_Resource_Request_": {
      "type": "object",
      "properties": {
        "content": {
          "type": "string",
          "description": "Resource content."
        },
        "path": {
          "type": "string",
          "example": "firewall.xml",
          "description": "File path"
        },
        "id": {
          "type": "string",
          "example": "filebeat-config",
          "description": "Id of the resource."
        }
      },
      "required": [
        "content",
        "id",
        "path"
      ]
    },
    "Config_Request_": {
      "type": "object",
      "properties": {
        "parameters": {
          "description": "List of parameters.",
          "type": "array",
          "items": {
            "$ref": "#/definitions/Config_Parameter_Request_"
          }
        },
        "actions": {
          "description": "List of actions.",
          "type": "array",
          "items": {
            "$ref": "#/definitions/Config_Action_Request_"
          }
        },
        "resources": {
          "description": "List of resources.",
          "type": "array",
          "items": {
            "$ref": "#/definitions/Config_Resource_Request_"
          }
        }
      }
    },
    "Config_Response_": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "action",
            "parameter",
            "resource"
          ],
          "example": "action",
          "description": "Type of the response."
        },
        "error": {
          "type": "boolean",
          "example": true,
          "description": "Indicate the presence of an error."
        }
      }
    },
    "Status_Response_": {
      "type": "object",
      "properties": {
        "password": {
          "type": "string",
          "description": "Password for the CB to connect to this LCP."
        },
        "id": {
          "type": "string",
          "example": "apache",
          "description": "ID of the execution environment."
        },
        "last_heartbeat": {
          "type": "string",
          "format": "date-time",
          "example": "2019/02/14 15:23:33",
          "description": "Timestamp of the expiration of the API access configuration."
        },
        "username": {
          "type": "string",
          "description": "Username for the CB to connect to this LCP."
        },
        "started": {
          "type": "string",
          "format": "date-time",
          "example": "2019/02/14 15:23:30",
          "description": "Timestamp when the LCP is started"
        }
      },
      "required": [
        "id",
        "last_heartbeat",
        "started"
      ]
    }
  }
}